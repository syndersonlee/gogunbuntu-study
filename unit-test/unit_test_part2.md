# Part 2 개발자에게 도움이 되는 테스트 만들기

## ch4 좋은 단위 테스트의 4대 요소

- 회귀 방지
- 리팩토링 내성
- 빠른 피드백
- 유지 보수성

### 회귀 방지

- 코드 수정 이후 기능이 의도하지 않은 대로 작동 하는 경우를 방지
    - 중요한 지표
        - 테스트 중에 실행되는 코드의 양
        - 코드 복잡도
        - 코드의 도메인 유의성
- 결론
    - 회귀 방지를 위해서는 테스트가 최대한 많은 코드를 실행 해야 함

### 리팩터링 내성

- 테스트가 실패가 되지 않고 코드를 리팩토링 가능 한지 확인
- 기반 코드를 수정 시 실 오류에 무관하게 테스트 코드에 에러가 발생하는 경우 : <b>거짓 양성</b>
- 이에 따라 구현은 수정해도 동작은 유지 가능 한 특성 : <b>리팩토링 내성</b>
- 리팩토링 내성이 없는 경우?
    - 테스트가 타당한 이유가 없이 실패해도 무시하게 되는 케이스 발생
    - 테스트 스위트에 대한 신뢰가 줄어 들어 리팩토링을 줄어들고 코드 변경을 최소화 함

### 거짓 양성의 원인

- 세부 구현 사항을 테스트에서 분리
- 하위 렌더링 클래스를 직접 구현하여 테스트를 진행할 경우 테스트 세부 사항과 결합
- 위의 방법의 경우 하위 구현 방법의 교체 될 경우 테스트가 깨질 가능성이 높음

### 책에서 제시하는 올바른 테스트

- 테스트 단계를 세부 구현 단계 1,2,3단계라고 가정할 때 책에서는 1,2,3단계에 대한 각각의 테스트를 옳지 못하다고 생각
- 최종 결과만을 테스트 하기 위해 1,2,3단계를 거친 결과 값만을 점검하는 것을 권장
- 메소드 파라미터가 추가되거나 늘어나는 케이스 정도를 제외하면 거짓 양성이 거의 없음


### 테스트 정확도

| 오류 유형 표 | 작동 | 고장 |
| -- | -- | -- |
| 테스트 통과 | 올바른 추론 (참 음성) | 2종 오류 (거짓 음성) |
| 테스트 실패 | 1종 오류 (거짓 양성) | 올바른 추론 |


- 테스트의 의미는 버그가 있음을 잘 나타내는 가와 버그가 없음을 잘 나타내는 두 지표가 매우 중요
- 테스트 정확도는 발견된 버그 수에 비례하고, 허위 경보 발생 수에 반비례

### 거짓 양성과 거짓 음성의 특징

- 거짓 양성은 초기에는 개발자의 기억에 의존하여 초기에는 중요하지 않을 것처럼 보임
- 프로젝트 사이즈가 커지고 코드 베이스가 커질 수록 리팩토링이 필요하고 이에 따라 거짓 양성을 발생시키는 테스트 코드는 아무런 역할을 하지 못함
- 프로젝트 사이즈가 커지기 전에 많은 프로젝트가 끝나기 때문에 이를 인지 못하는 경우가 많음


### 빠른 피드백과 유지 보수성

- 테스트가 오래 걸리는 경우 버그가 늦게 눈에 띄고 자주 실행이 어려움 (엔드 투 엔드 테스트)
- 유지비가 많이 드는 테스트는 두가지가 있음
    - 테스트 코드 라인이 클 경우
    - 테스트에 외부 존속성이 높아 실행이 까다로운 경우

### 4대 요소의 저울질

- 단위 테스트의 4가지 요소를 모두 고려해야 좋은 테스트
- 하나가 0점이면 다른 것들이 높아도 좋지 않은 코드

#### 엣지 케이스 : 엔드 투 엔드 케이스

- 모든 요소가 다 훌륭한 테스트지만, 피드백이 매우 느리기 때문에 테스트 확인까지 느리다는 단점이 있음

#### 엣지 케이스 : 간단한 케이스

- 코드와 로직이 매우 간단하기 때문에 회귀 방지가 없음

#### 엣지 케이스 : 깨지기 쉬운테스트

- SQL문을 그대로 넣는 케이스를 예시로 실행이 빠르고 회귀 또한 캐치가 가능하지만, 리팩토링 진행했을 때 테스트가 바로 실패하는 것을 볼 수 있음

#### 결론

- 리팩토링 내성의 경우 일반적으로 0 or all의 특성을 가지고 있는 경우가 많음
- 회귀 방지와 빠른 피드백 사이는 조절이 가능
- 일반적으로 빠른 리팩토링 특성을 포기하지 않으면서 두 가지 중에 절충을 하는 것이 Best Practice

### 자동화 테스트의 개념

- 대부분의 테스트의 숫자는 아래의 규칙이 일반적이고 숫자가 적을 수록 유저 친화적인 테스트
   - 엔드 투 엔드 테스트 < 통합 테스트 < 단위 테스트
- 어느 상태에서도 리팩토링 내성은 포기하지 않는 것이 중요
    - 회귀 방지 우선 : <b>엔드 투 엔드 테스트</b>
    - 절충 : <b>통합 테스트</b>
    - 빠른 피드백 우선 : <b>단위 테스트</b>
- 기본적인 CRUD 위주로 작업이 많을 수록 단위 테스트와 통합 테스트만 존재하는 직사각형 행태로 변함

#### 블랙박스 테스트와 화이트 박스 테스트 개념

- 블랙 박스 테스트 : 기능 검증
- 화이트박스 테스트 : 내부 구현 검증

| | 회귀 방지 | 리팩토링 내성 |
| -- | -- | -- |
| 화이트박스 테스트 | 좋음 | 나쁨 |
| 블랙박스 테스트 | 나쁨 | 좋음 |

- 복잡한 알고리즘 이외에는 블랙박스 테스트가 디폴트로 사용하는 것이 좋음