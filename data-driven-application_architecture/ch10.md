# ch10 일괄 처리

- 시스템의 3가지 분류
    - 서비스 (온라인 시스템)
        - 클라이언트의 응답을 대기하고 회신하는 시스템
        - 성능 = response time + 가용성
    - 일괄 처리 시스템 (오프라인 시스템)
        - 큰 입력 데이터를 받아 작업 수행 후 데이터 생산
        - 성능 = 처리량
    - 스트림 처리 시스템 (준실시간 시스템)
        - 입력이 발생 후 입력 데이터를 소비하여 출력 데이터 생산

- 맵 리듀스 및 기타 일괄 처리 알고리즘 및 프레임워크 확인을 위한 장

## 유닉스 도구로 일괄 처리하기

### 단순 로그 분석

- Sample

```
cat /var/log/nginx/access.log | \
  awk '{print $7}' | \ # 7번째 필드 출력 ($0은 전체)
  sort  | \ # 정렬
  uniq -c | \ # 중복 제거 ('-c': 중복횟수 첫번째로 함께 출력) 
  sort -r -n | \ # 정렬 ('-r': 내림차순, '-n' : 숫자로 정렬)
  head -n 5 # 맨 앞 5줄만 출력
```

- 유닉스 도구의 조합을 통해 많은 데이터 분석 가능

#### 연쇄 명령 대 맞춤형 프로그램

- 맞춤형 프로그래밍의 경우 연쇄 명령보다 코드가 더 길지만 읽기는 쉬움

#### 정렬 대 인메모리 집계

- 루비 스크립트는 URL을 Hash Table에 적재
- 유닉스 파이프 라인은 URL을 명령어 마다 기입
- 특징
    - 작업 세트가 작을 경우 Hash Table을 쓰는 것도 나쁘지 않음
    - 메모리 보다 작업 세트가 클 경우 정렬 접근법을 사용하는 것이 좋음
        - 데이터 청크를 정렬하여 세그먼트 파일로 디스크에 저장
        - 세그먼트 파일을 큰 정렬 파일로 병합
        - 위 작업을 통해 큰 데이터셋으로 확장 가능

### 유닉스 철학

- 유닉스 철학의 방식
    1. 각 프로그램은 하나의 일 만하도록 작성
    2. 모든 프로그램의 출력은 알려지지 않은 프로그래밍의 입력으로 사용 가능
    3. S/W 및 OS는 빠르게 써볼 수 있도록 구축해야 함
    4. 프로그래밍 작업을 줄이기 위해서는 도구를 사용하라
- Agile 방식 및 DevOps 운동과 비슷


#### 동일 인터페이스

- 특정 출력을 다른 입력으로 쓰려면 모두 호환 가능한 인터페이스 사용 필요
- 관례 상 연속된 바이트를 아스키 바이트 취급
- 유닉스는 같은 레코드 분리자를 사용하여 표준화 하였음
- 유닉스의 통합 인터페이스는 이종 간 데이터가 이동이 유용하게 구축 되어 있음
    - 이와 다르게 데이터베이스는 시스템 간 발칸화(갈라파고스 현상)

#### 로직과 연결의 분리

- 표준 입력과 출력 사용
    - 디스크에 쓰지 않고 작은 인메모리 버퍼를 이용하여 데이터를 전송
- 입출력을 신경 쓰지 않고 연결
    - 느슨한 결합
    - 지연 바인딩
    - 제어 바인딩
- 프로그램을 직접 작성하여 운영체제에서 지원하는 도구와 같이 사용 가능
- 제약 사항
    - 여러 입력 및 출력이 필요할 때 까다로움
    - 네트워크 작업이나 I/O를 묶을 경우 유연함은 감소

#### 투명성과 실험

- 유닉스 도구는 불친절하고 단순하지만, 진행 사항 파악이 쉬움
    - 입력 파일은 불변 처리
    - 파이프라인 중단 후 출력 확인 가능
    - 파이프라인 확인 시 데이터를 파일에 저장하고 다음 단계를 추후 재시작 가능
- 가장 큰 제약은 단일 장비에서만 실행 가능

## 맵 리듀스와 분산 파일 시스템

### 맵리듀스 작업 실행하기
### 리듀스 사이드 조인과 그룹화
### 맵 사이드 조인
### 일괄 처리 워크플로의 출력
### 하둡과 분산 데이터베이스 비교

## 맵 리듀스를 넘어
### 중간 상태 구체화
### 고수준 API와 언어