# ch5 서버 설정 최적화

- mySQL 설정 조작시 확인 해야 하는 것   
    - 버퍼 풀 및 로그 파일 크기의 기본 값이 적절한 지 확인
    - 특별한 이유가 없으면 설정은 조작하는 것이 아님

## MySQL 설정이 동작하는 방법

- 일반적인 설정 파일은 /etc/mysql/my.cnf 혹은 /etc/my.cnf에서 확인 가능

### 구문, 범위 및 다이나믹 여부

- 주의해야 할 것 사항
    - max_connections 변수는 전역
    - sort_buffer_size는 기본적으로 전역이나 세션별로 설정 가능
    - join_buffer_size는 기본적으로 전역이고 세션별로 설정 가능하지만, 테이블 조인 시에 하나의 버퍼를 할당 받아 여러 조인 버퍼 사용 가능
- Default 설정 시 전역 변수 값으로 지정

### 지속 시스템 변수

- DB를 재시작 시 설정 파일에 지정된 값으로 되돌아가는 것을 확인
- MySQL 8.0 이후 부터는 SET PERSIST를 런타임 시 설정하고 이후 디스크에 저장해서 가져옴

### 변수 설정 부작용

- 변수 동적 설정 시 서버가 많은 작업을 수행해야 하므로 주의
- 일부 변수 동적 변경 시 수행 결과
    - table_open_cache
        - 다음 스레드가 테이블을 열 시에 효과 수행
        - 변수 값을 확인하여 테이블에 캐시 삽입
    - thread_cache_size
        - 다음 스레드가 테이블을 열 시에 효과 수행
        - 나중 연결에서 사용할 수 있도록 스레드 캐시
    - read_buffer_size
        - 버퍼가 필요할 경우 전체 메모리에 지정 사이즈 만큼 할당
    - read_rnd_buffers_size
        - 필요한 만큼 메모리 할당
- 특정 쿼리가 필요할 때 값을 올리는 게 나음

### 변수 변경 계획

- 변수 설정 시 잘못 설정할 경우 메모리 부족 현상 및 서버 스왑 현상 발생 가능
- 버전 제어를 통해 설정 파일 변경 사항 추적
- 인덱스 추가 같은 내용을 통해 스키마 최적화 선행 필요

### 하지 말아야 할것

- 비율로 튜닝하는 것은 금지
- 튜닝 보다는 최적화, 설정이라는 단어를 선호
- 인기 있는 메모리 공식은 예전 버전 이야기라 너무 믿을 필요 없다

### MySQL 설정 파일 생성

#### 최소 설정

- 책 참조
- 일반적으로 해당 설정 파일들을 /var/lib/mysql에서 사용
- 다만 중요한 것은 open_files_limits 옵션
    - 일반적인 Linux 시스템에서 작게 설정할 경우 too many files 이슈 발생

### MySQL 서버 상태 변수 점검

- mysqladmin extended-status -ri60
    - 60초마다 상태 변수에 대한 점진적 변경 확인

## 메모리 사용량 설정

- innodb_dedicated_server만 사용하면 일반적으로 50% - 75%를 사용
- 나머지 기타 시스템 메모리 설정에 대해 최소 25%를 남김

### 연결 당 메모리 요구사항
### 운영 체제를 위한 메모리 예약
### InnoDB 버퍼 풀
### 스레드 캐시

## MySQL I/O 동작 설정

### InnoDB 트랜잭션 로그
### 로그 버퍼
### InnoDB 테이블 스페이스
### 다른 I/O 설정

## MySQL 동시성 설정

## 안전 설정

## 고급 InnoDB 설정