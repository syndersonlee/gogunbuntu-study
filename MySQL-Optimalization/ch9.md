# 9장 복제

- MySQL 내장 복제 기능은 **Scale Out** 이라는 아키텍처를 사용하여 고성능 어플리케이션을 구축
- 복제는 고가용성, 확장성, 재해 복구, 백업, 분석, 데이터 웨어하우징
- 반동기 복제, 다중 소스 복제에 대해 설명

## 복제 개요

- 가장 기본 적인 방법
    - 동일한 토폴로지 내의 데이터베이스 인스턴스 간에 데이터를 계속해서 동기화
    - 이로 인한 레플리카 지연의 가능성은 무한히 가능
- MySQL의 복제는 대부분 이전 버전과 호환
    - 다만 상위 호환성은 장담 불가
- 전체 시스템이 가장 약한 부분이 수행 할 수 있는 쓰기 횟수로 제한
- 복제의 사용 방법
    - 데이터 분산
        - 레플리카의 데이터 지연 시간을 줄이고, 복제를 언제든 재시작 
    - 읽기 트래픽 확장
        - 읽기 쿼리를 여러 서버로 분산해서 트래픽 감소
    - 백업
    - 분석 및 보고
        - 분석 용 OLAP DB로 사용
    - 고가용성 및 장애 조치
        - MySQL이 단일 장애 지점이 되는 것을 방지 가능
    - MySQL 업그레이드 테스트

### 복제 작동 방식

- MySQL이 데이터를 복제하는 방법
    - 3단계 프로세스
        1. 소스는 데이터를 '바이너리 로그 이벤트'로 기록
        2. 레플리카는 위 정보를 로컬 릴레이 로그에 복사
        3. 릴레이 로그의 이벤트를 재생하여 변경 사항 적용

## 복제의 내부 동작

- 복제 구성을 위한 고급 옵션 확인

### 복제 형식 선택

- 복제를 위해 제공하는 바이너리 로그 형식
    - 명령문 기반
        - 문제점 : 비결정적 쿼리로 인한 레플리카와 메인 DB의 불일치 데이터 삭제
    - 행 기반
        - 문제점 : 모든 행에 대해 작성할 경우 바이너리 로그 크기가 크게 증대
    - 혼합 기반
        - 명령문 방식을 기본으로 필요할 때만 행 방식 사용
- 일시적으로 명령문 기반이 아닌 경우 행 기반 복제가 안전

### 전역 트랜잭션 식별자
### 복제 충돌의 대비
### 지연 복제
### 멀티 스레드 복제
### 반동기 복제
### 복제 필터

## 복제 페일 오버

### 계획된 승격
### 계획되지 않은 승격
### 승격의 트레이드 오프

## 복제 토폴로지

### 액티브/패시브
### 액태브/리드 풀
### 권장되지 않는 토폴로지

## 복제 관리 및 유지 관리

### 복제 모니터링
### 복제 지연 측정
### 레플리카와 소스의 일치 여부 확인

## 복제 문제와 해법

### 소스의 바이너리 로그 손상
### 고유하지 않은 서버 ID
### 정의되지 않은 서버 ID
### 임시 테이블 누락
### 모든 업데이트를 복제하지 않음
### 과도한 복제 지연
### 소스의 오버사이즈 패킷
### 디스크 공간 없음
### 복제 제한 사항