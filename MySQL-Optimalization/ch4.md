# ch4 운영체제 하드웨어 최적화

## MySQL의 성능을 제한하는 요소

- 대부분은 CPU 성능 고갈로 인한 이슈가 많이 발생
    - 현재는 SDD 사용으로 인해 I/O 성능 저하 체감이 둔화

## MySQL용 CPU를 선택하는 방법

- 중요 쿼리에 대한 CPU 사용률과 I/O 균형률 수치가 핵심
    - 짧은 대기 시간
    - 높은 처리량

## 메모리 및 디스크 리소스의 균형 유지

- 메모리 접속으로 인한 I/O 시간이 디스크 I/O 보다 훨씬 빠름

### 읽기, 쓰기, 캐싱

- 읽기의 경우 캐시 히트로 메모리의 논리적 읽기로 성능 커버가 가능
- 쓰기의 경우 캐시로 쓰기 지연은 가능하나 배제는 불가능
- 쓰기를 그룹화 하는 두 가지 옵션
    - 다수의 쓰기, 한 번의 플러시
        - 카운터를 두고 그 수치 이후 Flush를 통해 디스크에 적용하는 형태
    - I/O 병합 (?)
- 랜덤 I/O가 수행되지만 선행 로그 기법을 진행 후 디스크에 플러시하여 쓰기를 최적화

### 작업 세트란?

- 실제 작업을 수행하는 데에 필요한 작업의 모음들
- HDD를 사요할 경우 효과적인 디스크와 메모리 비율을 찾는 것이 중요

## 솔리드 스테이트 스토리지

- 매우 큰 OLAP 시스템이나 데이터 웨어 하우스 및 레거시 시스템이 아닐 경우 일반적으로 SDD를 사용
- 자기 플래터 대신 셀로 구성된 비휘발성 메모리 메모리 칩(NVRAM)을 사용
- NVRAM 성능 특징
    - 하드 드라이브에 비해 랜덤 읽기 및 쓰기 성능이 우수
    - 순차 읽기 성능 및 쓰기 성능이 뛰어남
    - 동시성 기능 지원이 뛰어남

### 플래시 메모리 개요

- 플래시 메모리의 특징
    - 짧고 여러 번 읽는 데 효과적
    - 쓰기에 어려움
        - 새로운 쓰기가 필요할 때 특별한 지우기가 필요
        - 장치가 페이지를 잘 배치해야 함
        - 쓰기 증폭
            - 부분 블록 쓰기로 인한 데이터 이동

### 가비지 컬렉션

- 새로운 쓰기를 위해서 일부 블록을 깨끗하게 유지하기 위한 <b>쓰기 증폭 계수</b> 증가
- 장치가 가득 찰 수록 속도가 지연

## RAID 성능 최적화

- RAID는 데이터를 많이 저장하기에 좋은 옵션
- RAID 옵션
    - RAID 0
        - 가장 저렴하고 성능이 뛰어난 구성
        - 중복성을 제공하지 않음
    - RAID 1
        - 디스크 용으로 데이터를 복제
        - 로깅 및 비슷한 워크 로드 처리 시 이점을 가짐
    - RAID 5
        - 여러 디스크에 데이터 블록을 분산해서 저장
        - 디스크에 장애가 생겼을 경우 모든 디스크를 읽어 재구성 필요
        - 컨트롤러의 캐시 성능과 직결
    - RAID 6
        - 디스크 2개의 손실이 치명적
        - 디스크가 많아질 수록 장애가 많아짐
    - RAID 10
        - 스트라이프 되어 있고 미러링 된 쌍으로 구성
        - RAID 5에 비해 빠르고 쉽게 구축 가능
    - RAID 50
        - RAID 5 어레이로 구성되어 있음
        - 디스크가 많은 경우 5의 경제성과 10의 성능을 절충
        - OLTP에 자주 사용

| 레벨 | 중복 | 필요 디스크 | 읽기 가속 | 쓰기 가속 | 요약 |
| -- | -- | -- | -- | -- | -- |
| RAID 0 | 불가 | N | 가능 | 가능 | 저렴함, 위험 |
| RAID 1 | 가능 | 2 | 가능 | 불가 | 빠른 읽기, 간편함, 안전함 |
| RAID 5 | 가능 | N + 1 | 가능 | 상황에 따라 다름 | SSD로 저렴하고 빠름 |
| RAID 6 | 가능 | N + 2 | 가능 | 상황에 따라 다름 | RAID 5와 유사하지만 복원력이 더 뛰어남 |
| RAID 10 | 가능 | 2N | 가능 | 가능 | 고가, 빠름, 안전함 |
| RAID 50 | 가능 | 2(N + 1) | 가능 | 가능 | 매우 큰 데이터 저장소 목적 |

### RAID 장애, 복구 및 모니터링

- 가장 중요한 요소는 RAID 어레이 모니터링
- 에레이 길이가 길수록 검사에 많은 시간 소요
- 디스크가 많을 수록 고장 확률이 증가
- 배터리 장애 시 라이트백 캐시 -> 동시 쓰기로 캐시 정책 변환
    - 이로 인한 성능 저하 가능
- `innodb_flush_log_at_trx_commit` 및 `sync_binlog` 변수를 낮은 지속성 서버로 변경 처리
    - 디스크 사용률이 낮아지고 적절한 성능 제공 가능
    - 데이터 베이스 중단 시 손실될 수 있는 양 증대

### RAID 구성 및 캐싱

- 컨트롤러의 가장 중요한 속성   
    - 청크 크기
    - 컨트롤러 캐시

#### RAID 스트라이프 청크 크기

## 네트워크 설정

## 파일시스템 선택하기

### 디스크 큐 스케줄러 선택

### 메모리와 스와핑

### 운영 시스템 상태

### 그 외 유용한 도구들

